<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>NotAldim | V30</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { --blue: #0095f6; --bg: #000; --card: #121212; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; padding-bottom: 70px; }
        
        /* Geli≈ümi≈ü Progress Overlay */
        #loading-screen {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 9999;
        }
        .progress-container { width: 80%; text-align: center; }
        .progress-bar-bg { width: 100%; background: #333; height: 12px; border-radius: 6px; margin: 15px 0; overflow: hidden; }
        #progress-bar-fill { width: 0%; height: 100%; background: var(--blue); transition: width 0.1s; }
        #percent-display { font-size: 30px; font-weight: bold; color: var(--blue); margin-bottom: 5px; }

        .page { display: none; padding: 20px; max-width: 500px; margin: 0 auto; }
        .page.active { display: block; }
        input, textarea, select { width: 100%; background: #1a1a1a; border: 1px solid #333; padding: 12px; border-radius: 8px; color: white; margin-bottom: 10px; }
        button { width: 100%; background: var(--blue); border: none; padding: 12px; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; }
        .note-card { background: var(--card); border: 1px solid #262626; padding: 15px; border-radius: 12px; margin-bottom: 15px; }
        .media-content { width: 100%; border-radius: 8px; margin-top: 10px; max-height: 400px; object-fit: contain; }
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #000; display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #262626; }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="progress-container">
            <div id="percent-display">0%</div>
            <div class="progress-bar-bg"><div id="progress-bar-fill"></div></div>
            <p id="status-text">ƒ∞≈ülem Ba≈ülƒ±yor...</p>
        </div>
    </div>

    <div id="auth-page" class="page active">
        <h1 style="text-align:center;">NotAldim</h1>
        <input type="text" id="u" placeholder="Kullanƒ±cƒ± Adƒ±">
        <input type="password" id="p" placeholder="≈ûifre">
        <button onclick="login()">Giri≈ü Yap</button>
    </div>

    <div id="app" style="display:none;">
        <div id="home-page" class="page"><h2>Akƒ±≈ü</h2><div id="note-list"></div></div>
        <div id="add-page" class="page">
            <h2>Payla≈ü</h2>
            <input type="text" id="nt-t" placeholder="Ba≈ülƒ±k">
            <textarea id="nt-b" placeholder="Mesajƒ±n..."></textarea>
            <select id="nt-type" onchange="document.getElementById('file-box').style.display = this.value==='text'?'none':'block'">
                <option value="text">Yazƒ±</option>
                <option value="image">Resim</option>
                <option value="video">Video</option>
            </select>
            <input type="file" id="file-box" style="display:none;">
            <button onclick="saveNote()">≈ûimdi Payla≈ü</button>
        </div>
        <div class="nav-bar">
            <div onclick="show('home-page')">üè†</div>
            <div onclick="show('add-page')">‚ûï</div>
            <div onclick="location.reload()">üö™</div>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAFcxbgumt1FFDqZAYGbYWAaLyplMB6yM4",
        authDomain: "notsakla-a165c.firebaseapp.com",
        databaseURL: "https://notsakla-a165c-default-rtdb.firebaseio.com",
        projectId: "notsakla-a165c",
        storageBucket: "notsakla-a165c.firebasestorage.app",
        messagingSenderId: "374348253046",
        appId: "1:374348253046:web:cb9b66993d80f682911c57"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let user = null;

    function login() {
        const u = document.getElementById('u').value.toLowerCase();
        const p = document.getElementById('p').value;
        db.ref('users/'+u).once('value', s => {
            if(s.val() && s.val().pass == p) {
                user = u;
                document.getElementById('auth-page').style.display='none';
                document.getElementById('app').style.display='block';
                show('home-page');
                load();
            } else alert("Hatalƒ±!");
        });
    }

    async function saveNote() {
        const t = document.getElementById('nt-t').value;
        const b = document.getElementById('nt-b').value;
        const type = document.getElementById('nt-type').value;
        const file = document.getElementById('file-box').files[0];
        if(!t) return alert("Ba≈ülƒ±k?");

        const screen = document.getElementById('loading-screen');
        const bar = document.getElementById('progress-bar-fill');
        const pTxt = document.getElementById('percent-display');
        const sTxt = document.getElementById('status-text');

        screen.style.display = 'flex';
        let media = "";

        if(type !== 'text' && file) {
            media = await new Promise((res) => {
                const r = new FileReader();
                r.onprogress = (e) => {
                    const p = Math.round((e.loaded / e.total) * 100);
                    bar.style.width = p + '%';
                    pTxt.innerText = '%' + p;
                    sTxt.innerText = "Dosya ƒ∞≈üleniyor...";
                };
                r.onload = () => res(r.result);
                r.readAsDataURL(file);
            });
        }

        sTxt.innerText = "Buluta Kaydediliyor (L√ºtfen Bekle)...";
        db.ref('users/'+user+'/notes').once('value').then(s => {
            let n = s.val() || [];
            n.push({ t, b, type, media, d: new Date().toLocaleString() });
            db.ref('users/'+user+'/notes').set(n).then(() => {
                screen.style.display = 'none';
                alert("Ba≈üarƒ±lƒ±!");
                show('home-page');
            }).catch(() => {
                screen.style.display = 'none';
                alert("Hata: Video √ßok b√ºy√ºk!");
            });
        });
    }

    function load() {
        db.ref('users/'+user+'/notes').on('value', s => {
            const n = s.val() || [];
            document.getElementById('note-list').innerHTML = n.map(i => `
                <div class="note-card">
                    <b>${i.t}</b><br><small>${i.d || ''}</small>
                    <p>${i.b}</p>
                    ${i.type=='image'?`<img src="${i.media}" class="media-content">`:''}
                    ${i.type=='video'?`<video src="${i.media}" controls class="media-content"></video>`:''}
                </div>`).reverse().join('');
        });
    }

    function show(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
</script>
</body>
</html>

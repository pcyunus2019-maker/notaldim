<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>NotAldim | V93 Titanium Shield</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        :root { --blue: #0095f6; --bg: #000; Ã¦--card: #000; --border: #262626; --red: #ed4956; --green: #78de45; --grad: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: var(--bg); color: white; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; padding-top: 60px; padding-bottom: 75px; overflow-x: hidden; }
        
        /* TIKLAMA FIX: Sayfa YapÄ±sÄ± */
        .page { display: none; width: 100%; max-width: 500px; margin: 0 auto; position: relative; z-index: 1; }
        .page.active { display: block; animation: fadeIn 0.2s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Header & Nav (TÄ±klanabilir kÄ±lÄ±ndÄ±) */
        .header { position: fixed; top: 0; width: 100%; height: 60px; background: #000; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 15px; z-index: 1000; }
        .nav { position: fixed; bottom: 0; width: 100%; height: 60px; background: #000; border-top: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 1000; }
        .nav-i { font-size: 26px; cursor: pointer; opacity: 0.4; pointer-events: auto; }
        .nav-i.active { opacity: 1; color: var(--blue); }

        /* Story & Liste TasarÄ±mÄ± */
        .story-bar { display: flex; gap: 12px; overflow-x: auto; padding: 10px 15px; border-bottom: 1px solid #1a1a1a; scrollbar-width: none; }
        .story-ring { width: 66px; height: 66px; border-radius: 50%; background: var(--grad); padding: 2.5px; flex-shrink: 0; cursor: pointer; }
        .story-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 2px solid #000; }
        .list-item { display: flex; align-items: center; gap: 15px; padding: 12px 15px; cursor: pointer; border-bottom: 0.5px solid var(--border); position: relative; z-index: 2; }
        .p-img-round { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; }

        /* Post TasarÄ±mÄ± (Fix: Ad altta deÄŸil, Ã¼stte tekil) */
        .post-card { margin-bottom: 20px; border-bottom: 1px solid #1a1a1a; padding-bottom: 10px; }
        .post-header { display: flex; align-items: center; justify-content: space-between; padding: 10px 15px; cursor: pointer; }
        .post-body-text { padding: 0 15px 10px 15px; font-size: 15px; line-height: 1.4; color: #efefef; }

        /* UI ElemanlarÄ± */
        .glass-card { background: #121212; border: 1px solid var(--border); border-radius: 20px; padding: 20px; margin: 15px; position: relative; z-index: 10; }
        input, button, textarea, select { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid var(--border); background: #121212; color: #fff; margin-bottom: 10px; pointer-events: auto; }
        button { background: var(--blue); border: none; font-weight: 800; cursor: pointer; }
        .adm-btn { font-size: 11px; padding: 8px; margin-top: 5px; background: #1a1a1a; border-radius: 8px; border: 1px solid #333; cursor: pointer; }
        .hidden { display: none !important; }
        
        #chat-msgs { height: 65vh; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg-bubble { padding: 10px 16px; border-radius: 20px; font-size: 14px; max-width: 80%; }
        .msg-me { align-self: flex-end; background: var(--blue); }
        .msg-other { align-self: flex-start; background: #262626; }
    </style>
</head>
<body>

    <div class="header">
        <div style="font-size:24px; font-weight:800; letter-spacing:-1px;">Instagram</div>
        <div style="display:flex; gap:15px; font-size:22px;">
            <span onclick="nav('noti')">â¤ï¸</span>
            <span onclick="nav('msg')">ğŸ’¬</span>
        </div>
    </div>

    <div id="app">
        <div id="page-home" class="page active">
            <div id="story-list-area" class="story-bar"></div>
            <div id="feed-list"></div>
        </div>

        <div id="page-search" class="page">
            <div style="padding:15px;"><input type="text" placeholder="Ara..." oninput="doSearch(this.value)"></div>
            <div style="padding:0 15px 10px; font-weight:800; color:#555; font-size:13px;">KAYITLI ÃœYELER</div>
            <div id="user-list"></div>
        </div>

        <div id="page-add" class="page" style="padding:20px;">
            <h2>Yeni PaylaÅŸÄ±m</h2>
            <select id="p-vis"><option value="public">Herkese AÃ§Ä±k</option><option value="private">Sadece Ben</option></select>
            <textarea id="p-body" rows="5" placeholder="Neler oluyor?"></textarea>
            <input type="file" id="p-file">
            <button onclick="savePost()">Hemen YayÄ±nla</button>
        </div>

        <div id="page-msg" class="page">
            <div id="chat-list"></div>
            <div id="chat-box" class="hidden">
                <div id="chat-header-ui" style="display:flex; align-items:center; gap:10px; padding:10px 15px; border-bottom:1px solid #222;"></div>
                <div id="chat-msgs"></div>
                <div style="padding:10px; display:flex; gap:10px;">
                    <input id="m-in" placeholder="Mesaj..." style="margin:0; border-radius:25px;">
                    <button onclick="sendMsg()" style="width:60px;">â¤</button>
                </div>
            </div>
        </div>

        <div id="page-admin" class="page">
            <h2 style="padding:15px;">ğŸ›¡ï¸ YÃ¶netim</h2>
            <div id="ad-users-list"></div>
            <div id="ad-panel" class="hidden glass-card"></div>
        </div>

        <div id="page-prof" class="page" style="text-align:center; padding-top:30px;">
            <img id="u-img" style="width:100px; height:100px; border-radius:50%; object-fit:cover; border:2px solid var(--blue); cursor:pointer;" onclick="if(viewU==cur.user) document.getElementById('u-img-file').click()">
            <input type="file" id="u-img-file" class="hidden" onchange="updateProfilePic(this)">
            <h2 id="u-name"></h2>
            <div style="display:flex; justify-content:center; gap:30px; margin:20px 0;">
                <div><b id="p-followers">0</b><br><small>TakipÃ§i</small></div>
                <div><b id="p-following">0</b><br><small>Takip</small></div>
            </div>
            <div id="my-btns" class="hidden" style="padding:15px;">
                <button onclick="logout()" style="background:#1a1a1a; color:red;">Ã‡Ä±kÄ±ÅŸ Yap</button>
            </div>
            <div id="other-btns" class="hidden" style="padding:15px;">
                <button id="follow-btn" onclick="handleFollow()">Takip Et</button>
            </div>
        </div>
    </div>

    <div class="nav">
        <div class="nav-i active" onclick="nav('home', this)">ğŸ </div>
        <div class="nav-i" onclick="nav('search', this)">ğŸ”</div>
        <div class="nav-i" onclick="nav('add', this)">â•</div>
        <div class="nav-i" onclick="nav('msg', this)">ğŸ’¬</div>
        <div id="nav-ad" class="nav-i hidden" onclick="nav('admin', this)">ğŸ›¡ï¸</div>
        <div class="nav-i" onclick="nav('prof', this, true)">ğŸ‘¤</div>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAFcxbgumt1FFDqZAYGbYWAaLyplMB6yM4", authDomain: "notsakla-a165c.firebaseapp.com", databaseURL: "https://notsakla-a165c-default-rtdb.firebaseio.com", projectId: "notsakla-a165c", storageBucket: "notsakla-a165c.firebasestorage.app", appId: "1:374348253046:web:cb9b66993d80f682911c57" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let cur = null, viewU = null, activeChat = null;

    window.onload = () => {
        const saved = localStorage.getItem('notUser');
        if(saved) db.ref('users/'+saved).once('value', sn => { if(sn.exists()){ cur = sn.val(); startApp(); } });
    };

    function startApp() {
        document.getElementById('app').style.display = 'block';
        if(cur.role == 'admin') document.getElementById('nav-ad').classList.remove('hidden');
        loadFeed(); loadStories(); loadChatList(); loadAdminUsers();
        doSearch(""); // Arama sayfasÄ± iÃ§in Ã¼yeleri hazÄ±rla
    }

    // TIKLAMA FIX NAVIGASYON
    function nav(id, el, isMy) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('page-'+id).classList.add('active');
        document.querySelectorAll('.nav-i').forEach(i => i.classList.remove('active'));
        if(el) el.classList.add('active');
        if(isMy) viewProfile(cur.user);
        if(id == 'msg') closeChat();
        if(id == 'search') doSearch("");
    }

    // FEED (AD ÃœSTTE, TEKRAR YOK)
    function loadFeed() {
        db.ref('posts').on('value', sn => {
            const data = sn.val() || {}; let h = "";
            Object.keys(data).reverse().forEach(id => {
                const p = data[id];
                if(p.vis=='public' || p.owner==cur.user || cur.role=='admin') {
                    h += `<div class="post-card">
                        <div class="post-header" onclick="viewProfile('${p.owner}')">
                            <div style="display:flex;align-items:center;gap:10px;"><img src="${p.ownerImg}" class="p-img-round" style="width:35px;height:35px;"><b>${p.owner}</b></div>
                            ${(cur.role=='admin' || p.owner==cur.user) ? `<span onclick="db.ref('posts/${id}').remove()" style="color:red;font-size:11px;">SÄ°L</span>`:''}
                        </div>
                        ${p.media ? `<div style="padding:0 12px;"><img src="${p.media}" style="width:100%;border-radius:10px;"></div>` : ''}
                        <div class="post-body-text">${p.b}</div>
                    </div>`;
                }
            });
            document.getElementById('feed-list').innerHTML = h;
        });
    }

    // ÃœYELERÄ° LÄ°STELE
    function doSearch(v) {
        db.ref('users').once('value', sn => {
            const us = sn.val(); let h = "";
            for(let u in us) {
                if(u.includes(v.toLowerCase())) {
                    h += `<div class="list-item" onclick="viewProfile('${u}')">
                            <img src="${us[u].img}" class="p-img-round"><b>${u}</b>
                          </div>`;
                }
            }
            document.getElementById('user-list').innerHTML = h;
        });
    }

    // ADMIN MASTER
    function loadAdminUsers() {
        db.ref('users').on('value', sn => {
            const us = sn.val(); let h = "";
            for(let u in us) h += `<div class="list-item" onclick="manageTitan('${u}')"><img src="${us[u].img}" class="p-img-round"><b>${u}</b></div>`;
            document.getElementById('ad-users-list').innerHTML = h;
        });
    }
    function manageTitan(u) {
        db.ref('users/'+u).once('value', sn => {
            const d = sn.val(); document.getElementById('ad-panel').classList.remove('hidden');
            document.getElementById('ad-panel').innerHTML = `
                <h3>${u}</h3>
                <button class="adm-btn" onclick="admOp('${u}','pass')">Åifre DeÄŸiÅŸtir</button>
                <button class="adm-btn" onclick="admOp('${u}','user')">Ad DeÄŸiÅŸtir</button>
                <button class="adm-btn" onclick="admOp('${u}','fakeFollowers')">Fake TakipÃ§i</button>
                <button class="adm-btn" style="background:var(--blue)" onclick="db.ref('users/${u}/verified').set(true)">Mavi TÄ±k Ver</button>
                <button class="adm-btn" onclick="db.ref('users/${u}/verified').remove()">Mavi TÄ±k Al</button>
                <button class="adm-btn" style="background:orange" onclick="db.ref('users/${u}/banned').set(!${d.banned||false})">BANLA/KALDIR</button>
                <button class="adm-btn" style="background:red" onclick="if(confirm('Sil?')) db.ref('users/${u}').remove()">SÄ°L</button>`;
        });
    }

    // BASE LOGICS
    function viewProfile(u) { viewU = u; nav('prof'); db.ref('users/'+u).on('value', sn => { const d = sn.val(); document.getElementById('u-name').innerText = u; document.getElementById('u-img').src = d.img; document.getElementById('p-followers').innerText = d.fakeFollowers || (d.followers?Object.keys(d.followers).length:0); document.getElementById('p-following').innerText = d.following?Object.keys(d.following).length:0; if(u==cur.user) document.getElementById('my-btns').classList.remove('hidden'); else { document.getElementById('my-btns').classList.add('hidden'); document.getElementById('other-btns').classList.remove('hidden'); document.getElementById('follow-btn').innerText = (d.followers && d.followers[cur.user]) ? "Takibi BÄ±rak" : "Takip Et"; } }); }
    function handleFollow() { if(viewU=='admin') return; const rf=db.ref('users/'+viewU+'/followers/'+cur.user), ri=db.ref('users/'+cur.user+'/following/'+viewU); rf.once('value', sn=>{ if(sn.exists()){ rf.remove(); ri.remove(); } else { rf.set(true); ri.set(true); } }); }
    function closeChat() { document.getElementById('chat-box').classList.add('hidden'); document.getElementById('chat-list').classList.remove('hidden'); }
    function logout() { localStorage.removeItem('notUser'); location.reload(); }
    function admOp(u,k) { const v = prompt("Yeni DeÄŸer:"); if(v) db.ref('users/'+u+'/'+k).set(v); }
    function sendMsg() { const i = document.getElementById('m-in'); if(i.value) db.ref('chats/'+activeChat).push({u:cur.user, m:i.value, t:Date.now(), seen:false}); i.value=""; }
    function loadStories() { db.ref('stories').on('value', sn => { const s = sn.val() || {}; let h = ""; for(let u in s) h += `<div style="width:65px;height:65px;border-radius:50%;background:var(--grad);padding:2px;flex-shrink:0;"><img src="${s[u].img}" style="width:100%;height:100%;border-radius:50%;border:2px solid #000;object-fit:cover;"></div>`; document.getElementById('story-list-area').innerHTML = h; }); }
    function loadChatList() { db.ref('chats').on('value', sn => { const cs=sn.val()||{}; let h=""; Object.keys(cs).forEach(cid => { if(cid.includes(cur.user)){ const other=cid.replace(cur.user,'').replace('_',''); db.ref('users/'+other).once('value',usn=>{ h+=`<div class="list-item" onclick="openActiveChat('${other}')"><img src="${usn.val().img}" class="p-img-round"> <div style="margin-left:10px;"><b>${other}</b></div></div>`; document.getElementById('chat-list').innerHTML=h; }); }}); }); }
    function openActiveChat(other) { activeChat = [cur.user, other].sort().join('_'); document.getElementById('chat-list').classList.add('hidden'); document.getElementById('chat-box').classList.remove('hidden'); db.ref('users/'+other).once('value', sn => { document.getElementById('chat-header-ui').innerHTML = `<span onclick="closeChat()" style="font-size:24px; cursor:pointer;">â‡ </span><img src="${sn.val().img}" style="width:35px;height:35px;border-radius:50%;"> <b>${other}</b>`; }); db.ref('chats/'+activeChat).on('value', sn => { const ms = sn.val() || {}; let h = ""; Object.keys(ms).forEach(mid => { const m = ms[mid]; const isMe = m.u === cur.user; h += `<div style="text-align:${isMe?'right':'left'}; margin-bottom:8px;"><div class="msg-bubble ${isMe?'msg-me':'msg-other'}">${m.m}</div></div>`; }); document.getElementById('chat-msgs').innerHTML = h; }); }
    async function savePost() { const b=document.getElementById('p-body').value, f=document.getElementById('p-file').files[0], v=document.getElementById('p-vis').value; if(!b) return; const done=(m)=>db.ref('posts/'+Date.now()).set({b, media:m, vis:v, owner:cur.user, ownerImg:cur.img, up:0}).then(()=>nav('home')); if(f){ const r=new FileReader(); r.onload=()=>done(r.result); r.readAsDataURL(f); } else done(""); }
    function updateProfilePic(input) { const f = input.files[0]; if(f){ const r = new FileReader(); r.onload = (e) => db.ref('users/'+cur.user+'/img').set(e.target.result).then(()=>location.reload()); r.readAsDataURL(f); } }
</script>
</body>
</html>

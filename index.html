<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>NotAldim | V82 Omega Prime</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        :root { --blue: #0095f6; --bg: #000; --card: #121212; --border: #262626; --red: #ed4956; --green: #78de45; --grad: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: var(--bg); color: white; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; padding-bottom: 85px; overflow-x: hidden; }
        
        #loading { position:fixed; inset:0; background:#000; z-index:10000; display:none; flex-direction:column; align-items:center; justify-content:center; }
        .page { display: none; padding: 15px; max-width: 500px; margin: 0 auto; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }
        
        .glass-card { background: var(--card); border: 1px solid var(--border); border-radius: 24px; padding: 20px; margin-bottom: 20px; }
        input, textarea, select { width: 100%; background: #080808; border: 1px solid var(--border); padding: 14px; border-radius: 16px; color: white; margin-bottom: 12px; font-size: 14px; }
        button { width: 100%; background: var(--blue); border: none; border-radius: 16px; color: white; padding: 14px; font-weight: 800; cursor: pointer; }

        /* Story Styles */
        .story-bar { display: flex; gap: 15px; overflow-x: auto; padding: 10px 5px; margin-bottom: 15px; scrollbar-width: none; }
        .story-circle { width: 68px; height: 68px; border-radius: 50%; border: 3px solid var(--blue); padding: 3px; object-fit: cover; cursor: pointer; background: var(--grad); }
        
        /* Post Styles */
        .note-card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 15px; margin-bottom: 20px; position: relative; }
        .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
        .card-img { width: 42px; height: 42px; border-radius: 50%; object-fit: cover; border: 2px solid var(--blue); }
        
        .social-btns { display: flex; gap: 10px; margin-top: 15px; border-top: 1px solid #222; padding-top: 15px; }
        .s-btn { cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 4px; padding: 8px 12px; border-radius: 12px; background: #1a1a1a; border: 1px solid var(--border); }
        
        /* Chat Styles */
        #chat-messages { height: 500px; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; background: #050505; border-radius: 24px; }
        .msg-bubble { padding: 12px 18px; border-radius: 22px; font-size: 14px; position: relative; max-width: 80%; display: flex; flex-direction: column; }
        .msg-me { align-self: flex-end; background: var(--blue); border-bottom-right-radius: 4px; }
        .msg-other { align-self: flex-start; background: #262626; border-bottom-left-radius: 4px; }
        .tÄ±k-read { color: #00faff; font-weight: bold; }

        .nav { position: fixed; bottom: 0; width: 100%; background: rgba(0,0,0,0.95); backdrop-filter: blur(20px); border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 18px 0; z-index: 1000; }
        .nav-i { font-size: 26px; cursor: pointer; opacity: 0.3; }
        .nav-i.active { opacity: 1; color: var(--blue); }
        
        .verified-badge { color: var(--blue); margin-left: 4px; position: relative; cursor: help; }
        .verified-badge:hover::after { content: "OnaylÄ± Hesap"; position: absolute; bottom: 120%; left: 50%; transform: translateX(-50%); background: white; color: black; padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 800; white-space: nowrap; }

        #story-viewer { position:fixed; inset:0; background:#000; z-index:11000; display:none; flex-direction:column; align-items:center; justify-content:center; }
        .hidden { display: none !important; }
        .adm-btn { font-size: 11px; padding: 8px; margin-top: 5px; width: 100%; border-radius: 10px; }
        .comment-item { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 12px; margin-top: 8px; font-size: 13px; }
    </style>
</head>
<body>

    <div id="loading">PaylaÅŸÄ±lÄ±yor...</div>
    <div id="story-viewer">
        <div onclick="closeStory()" style="position:absolute; top:30px; left:25px; font-size:30px; cursor:pointer;">âœ•</div>
        <div id="st-del-btn" style="position:absolute; top:30px; right:25px; font-size:25px; cursor:pointer; display:none;">ğŸ—‘ï¸</div>
        <img id="st-img" style="max-width:100%; max-height:80vh; border-radius:15px;">
        <p id="st-user" style="margin-top:15px; font-weight:800;"></p>
    </div>

    <div id="auth-area">
        <div id="login-p" class="page active">
            <div class="glass-card" style="margin-top:80px; text-align:center;">
                <h1 style="font-weight:800; font-size:36px;">NotAldim</h1>
                <input type="text" id="l-u" placeholder="KullanÄ±cÄ± AdÄ±">
                <input type="password" id="l-p" placeholder="Åifre">
                <div style="margin-bottom:15px;"><input type="checkbox" id="l-rem" checked> <span style="font-size:14px; color:#888;">Beni HatÄ±rla</span></div>
                <button onclick="login()">GiriÅŸ Yap</button>
                <p onclick="goAuth('reg-p')" style="color:var(--blue); cursor:pointer; margin-top:20px;">Kaydol</p>
                <p onclick="goAuth('forgot-p')" style="color:#555; cursor:pointer; margin-top:10px; font-size:12px;">Åifre HatÄ±rlat</p>
            </div>
        </div>
        <div id="reg-p" class="page"><div class="glass-card"><h2>Kaydol</h2><input type="text" id="r-u" placeholder="KullanÄ±cÄ± AdÄ±"><input type="email" id="r-m" placeholder="E-Posta"><input type="password" id="r-p" placeholder="Åifre"><button onclick="register()">KayÄ±t Ol</button><p onclick="goAuth('login-p')" style="text-align:center; margin-top:15px;">Geri DÃ¶n</p></div></div>
        <div id="forgot-p" class="page"><div class="glass-card"><h2>Åifre HatÄ±rlat</h2><input type="text" id="f-u" placeholder="KullanÄ±cÄ± AdÄ±"><button onclick="alert('Åifreniz mail adresinize gÃ¶nderilecektir.')">Åifreyi GÃ¶nder</button><p onclick="goAuth('login-p')" style="text-align:center; margin-top:15px;">Geri DÃ¶n</p></div></div>
    </div>

    <div id="app" class="hidden">
        <div id="page-home" class="page active"><h2>AkÄ±ÅŸ</h2><div id="note-list"></div></div>
        
        <div id="page-add" class="page">
            <h2>Yeni PaylaÅŸÄ±m</h2>
            <select id="m-type" onchange="toggleM()"><option value="text">Sadece YazÄ±</option><option value="media">FotoÄŸraf / Video</option></select>
            <select id="m-vis"><option value="public">Herkese AÃ§Ä±k</option><option value="private">Gizli (Sadece Ben)</option></select>
            <input type="text" id="nt-t" placeholder="BaÅŸlÄ±k"><textarea id="nt-b" rows="4" placeholder="Ä°Ã§erik..."></textarea>
            <div id="m-area" class="hidden"><input type="file" id="m-file"></div>
            <button onclick="savePost()">PaylaÅŸ</button>
        </div>

        <div id="page-search" class="page">
            <h2>KeÅŸfet</h2>
            <div class="story-bar" id="search-story-list"></div>
            <input type="text" id="search-input" placeholder="Ãœye ara..." oninput="doSearch(this.value)">
            <div id="search-results"></div>
        </div>

        <div id="page-msg" class="page">
            <h2>Mesajlar</h2>
            <div id="chat-list"></div>
            <div id="chat-box" class="hidden">
                <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px;"><span onclick="closeChat()" style="cursor:pointer; font-size:20px;">â¬…</span><h3 id="chat-with-name"></h3></div>
                <div id="chat-messages"></div>
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <input id="msg-input" placeholder="Yaz..."><button onclick="sendMsg()" style="width:70px;">â¤</button>
                </div>
            </div>
        </div>
        
        <div id="page-admin" class="page"><h2>ğŸ›¡ï¸ Admin</h2><div id="ad-users-list"></div><div id="ad-user-detail" class="hidden glass-card"></div></div>

        <div id="page-prof" class="page">
            <div class="glass-card" style="text-align:center;">
                <img id="p-u-img" style="width:100px; height:100px; border-radius:50%; object-fit:cover; border:3px solid var(--blue);">
                <h2 id="p-u-name"></h2>
                <div style="display:flex; justify-content:center; gap:30px; margin:20px 0;">
                    <div onclick="showUsersList('followers')"><b>TakipÃ§i</b><br><span id="p-followers">0</span></div>
                    <div onclick="showUsersList('following')"><b>Takip</b><br><span id="p-following">0</span></div>
                </div>
                <div id="my-prof-actions" class="hidden">
                    <button onclick="document.getElementById('st-file').click()" style="background:var(--green); margin-bottom:10px;">ğŸ“¸ Hikaye Ekle</button>
                    <input type="file" id="st-file" class="hidden" onchange="uploadStory(this)">
                    <button onclick="logout()" style="background:var(--red);">GÃ¼venli Ã‡Ä±kÄ±ÅŸ</button>
                </div>
                <div id="other-prof-actions" class="hidden"><button id="follow-btn" onclick="handleFollowAction()">Takip Et</button><button onclick="openChatFromProf()" style="background:#222; margin-top:10px;">Mesaj GÃ¶nder</button></div>
            </div>
        </div>

        <div class="nav">
            <div class="nav-i active" onclick="nav('home', this)">ğŸ </div>
            <div class="nav-i" onclick="nav('search', this)">ğŸ”</div>
            <div class="nav-i" onclick="nav('add', this)">â•</div>
            <div class="nav-i" onclick="nav('msg', this)">ğŸ’¬</div>
            <div id="nav-ad" class="nav-i hidden" onclick="nav('admin', this)">ğŸ›¡ï¸</div>
            <div class="nav-i" onclick="nav('prof', this, true)">ğŸ‘¤</div>
        </div>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAFcxbgumt1FFDqZAYGbYWAaLyplMB6yM4", authDomain: "notsakla-a165c.firebaseapp.com", databaseURL: "https://notsakla-a165c-default-rtdb.firebaseio.com", projectId: "notsakla-a165c", storageBucket: "notsakla-a165c.firebasestorage.app", messagingSenderId: "374348253046", appId: "1:374348253046:web:cb9b66993d80f682911c57" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let cur = null, viewU = null, activeChat = null, activeStoryId = null;

    window.onload = () => {
        const saved = localStorage.getItem('notUser');
        if(saved) db.ref('users/'+saved).once('value', sn => { if(sn.exists() && !sn.val().banned) { cur = sn.val(); startApp(); } });
    };

    function startApp() {
        document.getElementById('auth-area').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        if(cur.role == 'admin') { document.getElementById('nav-ad').classList.remove('hidden'); loadAdminUsers(); }
        loadFeed(); doSearch(""); loadStories();
    }

    // STORY LOGIC
    function loadStories() {
        db.ref('stories').on('value', sn => {
            const stories = sn.val() || {}; let h = "";
            for(let u in stories) h += `<div onclick="viewStory('${u}')"><img src="${stories[u].img}" class="story-circle"></div>`;
            document.getElementById('search-story-list').innerHTML = h;
        });
    }
    function viewStory(u) {
        activeStoryId = u;
        db.ref('stories/'+u).once('value', sn => {
            document.getElementById('story-viewer').style.display='flex';
            document.getElementById('st-img').src=sn.val().img;
            document.getElementById('st-user').innerText = u;
            document.getElementById('st-del-btn').style.display = (u==cur.user || cur.role=='admin') ? 'block' : 'none';
            document.getElementById('st-del-btn').onclick = () => { if(confirm("Silinsin mi?")) db.ref('stories/'+u).remove().then(closeStory); };
        });
    }
    function closeStory() { document.getElementById('story-viewer').style.display='none'; }
    async function uploadStory(input) { const f = input.files[0]; if(!f) return; const r = new FileReader(); r.onload = async (e) => { await db.ref('stories/'+cur.user).set({img: e.target.result, time: Date.now()}); alert("Hikaye paylaÅŸÄ±ldÄ±!"); }; r.readAsDataURL(f); }

    // MSG LOGIC (âœ“âœ“ & Saat)
    function openActiveChat(other) {
        activeChat = [cur.user, other].sort().join('_');
        document.getElementById('chat-list').classList.add('hidden'); document.getElementById('chat-box').classList.remove('hidden');
        document.getElementById('chat-with-name').innerText = other;
        db.ref('chats/'+activeChat).on('value', sn => {
            const ms = sn.val() || {}; let h = "";
            Object.keys(ms).forEach(mid => {
                const m = ms[mid]; const isMe = m.u === cur.user;
                if(!isMe && !m.seen) db.ref('chats/'+activeChat+'/'+mid+'/seen').set(true);
                const tÄ±k = isMe ? (m.seen ? '<span class="tÄ±k-read">âœ“âœ“</span>' : 'âœ“') : '';
                const time = new Date(m.t).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
                h += `<div class="msg-bubble ${isMe?'msg-me':'msg-other'}">
                    ${m.m} <div style="font-size:8px; opacity:0.6; text-align:right; margin-top:4px;">${time} - ${m.u} ${tÄ±k}</div>
                </div>`;
            });
            const b = document.getElementById('chat-messages'); b.innerHTML = h; b.scrollTop = b.scrollHeight;
        });
    }
    function sendMsg() { const i = document.getElementById('msg-input'); if(!i.value) return; db.ref('chats/'+activeChat).push({u:cur.user, m:i.value, t:Date.now(), seen:false}); i.value=""; }

    // ADMIN POWER
    function loadAdminUsers() {
        db.ref('users').on('value', sn => {
            const us = sn.val(); let h = "<h3>Ãœyeler</h3>";
            for(let u in us) h += `<div class="s-btn" onclick="manageTitan('${u}')">${u}</div>`;
            document.getElementById('ad-users-list').innerHTML = h;
        });
    }
    function manageTitan(u) {
        db.ref('users/'+u).once('value', sn => {
            const d = sn.val(); document.getElementById('ad-user-detail').classList.remove('hidden');
            document.getElementById('ad-user-detail').innerHTML = `<div style="text-align:center;">
                <h3>${u} YÃ¶netimi</h3>
                <button class="adm-btn" onclick="admOp('${u}','user')">ğŸ‘¤ Ad DeÄŸiÅŸtir</button>
                <button class="adm-btn" onclick="admOp('${u}','mail')">ğŸ“§ Mail DeÄŸiÅŸtir</button>
                <button class="adm-btn" onclick="admOp('${u}','pass')">ğŸ”‘ Åifre DeÄŸiÅŸtir</button>
                <button class="adm-btn" onclick="admOp('${u}','fakeFollowers')">ğŸ“ˆ Fake TakipÃ§i</button>
                <button class="adm-btn" style="background:#333" onclick="db.ref('users/${u}/fakeFollowers').remove()">ğŸ”„ Normal SayÄ±</button>
                <button class="adm-btn" style="background:var(--blue)" onclick="db.ref('users/${u}/verified').set(true)">âœ” Mavi TÄ±k Ver</button>
                <button class="adm-btn" style="background:orange" onclick="db.ref('users/${u}/banned').set(!${d.banned||false})">ğŸš« BANLA/KALDIR</button>
                <button class="adm-btn" style="background:purple" onclick="viewPrivatePosts('${u}')">ğŸ‘ï¸ GÄ°ZLÄ°LERÄ° GÃ–R</button>
                <button class="adm-btn" style="background:var(--red)" onclick="if(confirm('Ãœye silinsin mi?')) db.ref('users/${u}').remove()">SÄ°L (TAMAMEN)</button>
            </div>`;
        });
    }
    function viewPrivatePosts(u) {
        db.ref('posts').once('value', sn => {
            const all = sn.val() || {}; let res = "Gizli Postlar:\n";
            for(let id in all) if(all[id].owner == u && all[id].vis == 'private') res += `- ${all[id].t}: ${all[id].b}\n`;
            alert(res);
        });
    }

    // BASE
    function loadFeed() {
        db.ref('posts').on('value', sn => {
            const data = sn.val() || {}; let h = "";
            Object.keys(data).reverse().forEach(id => {
                const p = data[id]; const myV = (p.votes && p.votes[cur.user]) ? 'voted-up' : '';
                if(p.vis == 'public' || p.owner == cur.user || cur.role == 'admin') {
                    h += `<div class="note-card">
                        <div class="card-header" onclick="viewProfile('${p.owner}')">
                            <div style="display:flex;align-items:center;gap:10px;"><img src="${p.ownerImg}" class="card-img"><b>${p.owner}</b></div>
                            ${cur.role=='admin' || p.owner==cur.user ? `<span onclick="db.ref('posts/${id}').remove()" style="color:red">SÄ°L</span>`:''}
                        </div>
                        <p><b>${p.t}</b><br>${p.b}</p>
                        ${p.media ? `<img src="${p.media}" style="width:100%;border-radius:15px;margin-top:10px;">`:''}
                        <div class="social-btns"><span class="s-btn ${myV}" onclick="handleVote('${id}','up')">â¤ï¸ ${p.up||0}</span></div>
                    </div>`;
                }
            });
            document.getElementById('note-list').innerHTML = h;
        });
    }

    function login() {
        const u = document.getElementById('l-u').value.trim().toLowerCase(), p = document.getElementById('l-p').value.trim();
        db.ref('users/'+u).once('value', sn => {
            const d = sn.val();
            if(d && d.banned) return alert("BanlandÄ±nÄ±z!");
            if(d && d.pass == p){ cur = d; localStorage.setItem('notUser', u); startApp(); } else alert("Hata!");
        });
    }
    function register() {
        const u = document.getElementById('r-u').value.trim().toLowerCase(), m = document.getElementById('r-m').value.trim(), p = document.getElementById('r-p').value.trim();
        db.ref('users/'+u).set({user:u, mail:m, pass:p, role:(u=='admin'?'admin':'user'), img:"https://cdn-icons-png.flaticon.com/512/149/149071.png"}).then(() => {
            // OTOMATÄ°K ADMÄ°N TAKÄ°BÄ°
            db.ref('users/admin/followers/'+u).set(true); db.ref('users/'+u+'/following/admin').set(true);
            location.reload();
        });
    }
    function viewProfile(u) {
        viewU = u; nav('prof', null);
        db.ref('users/'+u).on('value', sn => {
            const d = sn.val(); if(!d) return;
            document.getElementById('p-u-name').innerHTML = u + (d.verified ? '<span class="verified-badge">âœ”</span>' : '');
            document.getElementById('p-u-img').src = d.img;
            document.getElementById('p-followers').innerText = d.fakeFollowers || (d.followers ? Object.keys(d.followers).length : 0);
            document.getElementById('p-following').innerText = d.following ? Object.keys(d.following).length : 0;
            if(u == cur.user) document.getElementById('my-prof-actions').classList.remove('hidden');
            else { 
                document.getElementById('my-prof-actions').classList.add('hidden'); 
                document.getElementById('other-prof-actions').classList.remove('hidden');
                document.getElementById('follow-btn').innerText = (u=='admin') ? 'Sistem OnaylÄ±' : ((d.followers && d.followers[cur.user]) ? 'Takibi BÄ±rak' : 'Takip Et');
            }
        });
    }
    function handleFollowAction() { if(viewU=='admin') return; const rf = db.ref('users/'+viewU+'/followers/'+cur.user), ri = db.ref('users/'+cur.user+'/following/'+viewU); rf.once('value', sn => { if(sn.exists()){ rf.remove(); ri.remove(); } else { rf.set(true); ri.set(true); } }); }
    function nav(id, el, isMy = false) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById('page-'+id).classList.add('active'); if(isMy) viewProfile(cur.user); }
    function logout() { localStorage.removeItem('notUser'); location.reload(); }
    function goAuth(id) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(id).classList.add('active'); }
    function doSearch(val) { db.ref('users').once('value', sn => { const us = sn.val(); let h = ""; for(let u in us) if(u.includes(val.toLowerCase())) h += `<div class="glass-card" onclick="viewProfile('${u}')">${u}</div>`; document.getElementById('search-results').innerHTML = h; }); }
    async function savePost() { const t = document.getElementById('nt-t').value, b = document.getElementById('nt-b').value, file = document.getElementById('m-file').files[0], vis = document.getElementById('m-vis').value; if(!t) return; const done = (m) => db.ref('posts/'+Date.now()).set({t, b, media:m, vis, owner:cur.user, ownerImg:cur.img, up:0, votes:{}}).then(()=>location.reload()); if(file){ const r = new FileReader(); r.onload=()=>done(r.result); r.readAsDataURL(file); } else done(""); }
    function toggleM() { document.getElementById('m-area').classList.toggle('hidden', document.getElementById('m-type').value == 'text'); }
    function admOp(u, t) { const v = prompt("Yeni:"); if(v) { if(t=='user') { db.ref('users/'+u).once('value', sn => { db.ref('users/'+v).set(sn.val()).then(() => db.ref('users/'+u).remove()); }); } else db.ref('users/'+u+'/'+t).set(v); } }
    function handleVote(pid, type) { db.ref('posts/'+pid).transaction(p => { if(!p) return p; if(!p.votes) p.votes = {}; if(p.votes[cur.user]){ delete p.votes[cur.user]; p.up = Math.max(0, (p.up||1)-1); } else { p.votes[cur.user] = true; p.up = (p.up||0)+1; } return p; }); }
</script>
</body>
</html>

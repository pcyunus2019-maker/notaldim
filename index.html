<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>NotAldim | V33</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <style>
        :root { --blue: #0095f6; --bg: #000; --card: #121212; --border: #262626; }
        body { background: var(--bg); color: white; font-family: -apple-system, sans-serif; margin: 0; padding-bottom: 75px; }
        
        /* Y√úKLEME EKRANI - TASARIMI BOZMAZ */
        #loading-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 10000;
        }
        .loading-box { width: 80%; max-width: 300px; text-align: center; background: #1a1a1a; padding: 20px; border-radius: 15px; border: 1px solid var(--border); }
        #percent { font-size: 30px; font-weight: bold; color: var(--blue); }
        .bar-bg { width: 100%; background: #333; height: 10px; border-radius: 5px; margin: 15px 0; overflow: hidden; }
        #bar-fill { width: 0%; height: 100%; background: var(--blue); transition: width 0.2s; }

        /* ARAY√úZ */
        .page { display: none; padding: 20px; max-width: 500px; margin: 0 auto; }
        .page.active { display: block; }
        .auth-card { background: var(--card); border: 1px solid var(--border); padding: 30px; border-radius: 12px; text-align: center; margin-top: 50px; }
        input, textarea, select { width: 100%; background: #000; border: 1px solid #363636; padding: 12px; border-radius: 8px; color: white; margin-bottom: 10px; }
        button { width: 100%; background: var(--blue); border: none; padding: 12px; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; }
        .note-card { background: var(--card); border: 1px solid var(--border); padding: 15px; border-radius: 12px; margin-bottom: 15px; position: relative; }
        .media-content { width: 100%; border-radius: 8px; margin-top: 10px; max-height: 400px; object-fit: contain; }
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #000; border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 15px 0; }
        .nav-btn { font-size: 24px; cursor: pointer; opacity: 0.5; }
        .nav-btn.active { opacity: 1; color: var(--blue); }
        .del-btn { position: absolute; top: 10px; right: 10px; color: #ed4956; cursor: pointer; }
    </style>
</head>
<body>

    <div id="loading-overlay">
        <div class="loading-box">
            <div id="percent">0%</div>
            <div class="bar-bg"><div id="bar-fill"></div></div>
            <p id="load-status" style="font-size:12px;">Dosya Hazƒ±rlanƒ±yor...</p>
        </div>
    </div>

    <div id="auth-section">
        <div id="login-p" class="page active">
            <div class="auth-card">
                <h1 style="font-style:italic;">NotAldim</h1>
                <input type="text" id="l-u" placeholder="Kullanƒ±cƒ± Adƒ±">
                <input type="password" id="l-p" placeholder="≈ûifre">
                <button onclick="login()">Giri≈ü Yap</button>
                <p onclick="showP('reg-p')" style="color:var(--blue); cursor:pointer; font-size:13px; margin-top:15px;">Yeni Hesap Olu≈ütur</p>
                <p onclick="showP('forgot-p')" style="color:#8e8e8e; cursor:pointer; font-size:12px;">≈ûifremi Unuttum</p>
            </div>
        </div>

        <div id="reg-p" class="page">
            <div class="auth-card">
                <h2>Kayƒ±t Ol</h2>
                <input type="text" id="r-u" placeholder="Kullanƒ±cƒ± Adƒ±">
                <input type="email" id="r-e" placeholder="E-posta">
                <input type="password" id="r-p" placeholder="≈ûifre">
                <input type="text" id="r-i" placeholder="Profil Foto Link (Opsiyonel)">
                <button onclick="register()">Kayƒ±t Ol</button>
                <p onclick="showP('login-p')" style="color:var(--blue); cursor:pointer;">Geri D√∂n</p>
            </div>
        </div>

        <div id="forgot-p" class="page">
            <div class="auth-card">
                <h2>≈ûifre Kurtarma</h2>
                <input type="email" id="f-e" placeholder="E-posta Adresin">
                <button onclick="forgot()">≈ûifre G√∂nder</button>
                <p onclick="showP('login-p')" style="color:var(--blue); cursor:pointer;">Geri D√∂n</p>
            </div>
        </div>
    </div>

    <div id="main-app" style="display:none;">
        <div id="home-p" class="page"><h2>Akƒ±≈ü</h2><div id="note-list"></div></div>
        <div id="add-p" class="page">
            <h2>Yeni Not</h2>
            <input type="text" id="nt-t" placeholder="Ba≈ülƒ±k">
            <textarea id="nt-b" placeholder="Mesajƒ±n..."></textarea>
            <select id="nt-type" onchange="document.getElementById('f-in').style.display=this.value==='text'?'none':'block'">
                <option value="text">Sadece Yazƒ±</option>
                <option value="image">Fotoƒüraf</option>
                <option value="video">Video</option>
            </select>
            <input type="file" id="f-in" style="display:none; margin-bottom:10px;">
            <button onclick="save()">Payla≈ü</button>
        </div>
        <div id="prof-p" class="page" style="text-align:center;">
            <img id="u-img" style="width:100px; height:100px; border-radius:50%; border:2px solid var(--blue); margin-top:30px;">
            <h3 id="u-name"></h3>
            <button onclick="location.reload()" style="background:#333; margin-top:20px;">√áƒ±kƒ±≈ü Yap</button>
        </div>

        <div class="nav-bar">
            <div class="nav-btn active" onclick="nav('home-p', this)">üè†</div>
            <div class="nav-btn" onclick="nav('add-p', this)">‚ûï</div>
            <div class="nav-btn" onclick="nav('prof-p', this)">üë§</div>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAFcxbgumt1FFDqZAYGbYWAaLyplMB6yM4",
        authDomain: "notsakla-a165c.firebaseapp.com",
        databaseURL: "https://notsakla-a165c-default-rtdb.firebaseio.com",
        projectId: "notsakla-a165c",
        storageBucket: "notsakla-a165c.firebasestorage.app",
        messagingSenderId: "374348253046",
        appId: "1:374348253046:web:cb9b66993d80f682911c57"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let cur = null;
    emailjs.init("5_6-mB_mYm1L8_E5X");

    function showP(id) { document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); document.getElementById(id).classList.add('active'); }
    function nav(id, el) { showP(id); document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active')); el.classList.add('active'); }

    function register() {
        const u = document.getElementById('r-u').value.toLowerCase().trim();
        const e = document.getElementById('r-e').value.trim();
        const p = document.getElementById('r-p').value;
        const i = document.getElementById('r-i').value || 'https://via.placeholder.com/100';
        if(!u || !e || !p) return alert("Eksik bilgi!");
        db.ref('users/'+u).set({user:u, email:e, pass:p, img:i, role:'user'}).then(()=>{ alert("Kaydoldun!"); showP('login-p'); });
    }

    function login() {
        const u = document.getElementById('l-u').value.toLowerCase().trim();
        const p = document.getElementById('l-p').value;
        db.ref('users/'+u).once('value', s => {
            const d = s.val();
            if(d && d.pass == p) {
                cur = d;
                document.getElementById('auth-section').style.display='none';
                document.getElementById('main-app').style.display='block';
                document.getElementById('u-name').innerText = u;
                document.getElementById('u-img').src = d.img;
                nav('home-p', document.querySelector('.nav-btn'));
                load();
            } else alert("Hata!");
        });
    }

    function forgot() {
        const mail = document.getElementById('f-e').value;
        db.ref('users').once('value', s => {
            s.forEach(u => {
                if(u.val().email == mail) {
                    emailjs.send("service_x8fihv4", "template_p0y8vpa", { to_email: mail, user_id: u.val().user, password: u.val().pass });
                    alert("≈ûifren g√∂nderildi!");
                }
            });
        });
    }

    async function save() {
        const t = document.getElementById('nt-t').value;
        const b = document.getElementById('nt-b').value;
        const type = document.getElementById('nt-type').value;
        const file = document.getElementById('f-in').files[0];
        if(!t) return alert("Ba≈ülƒ±k?");

        document.getElementById('loading-overlay').style.display='flex';
        let media = "";

        if(type!=='text' && file) {
            media = await new Promise(res => {
                const r = new FileReader();
                r.onprogress = e => {
                    const p = Math.round((e.loaded/e.total)*100);
                    document.getElementById('bar-fill').style.width = p+'%';
                    document.getElementById('percent').innerText = p+'%';
                };
                r.onload = () => res(r.result);
                r.readAsDataURL(file);
            });
        }

        document.getElementById('load-status').innerText = "Buluta Kaydediliyor...";
        db.ref('users/'+cur.user+'/notes').once('value').then(s => {
            let n = s.val() || [];
            n.push({t, b, type, media, date: new Date().toLocaleString()});
            db.ref('users/'+cur.user+'/notes').set(n).then(() => {
                document.getElementById('loading-overlay').style.display='none';
                nav('home-p', document.querySelector('.nav-btn'));
            });
        });
    }

    function load() {
        db.ref('users/'+cur.user+'/notes').on('value', s => {
            const n = s.val() || [];
            document.getElementById('note-list').innerHTML = n.map((x, i) => `
                <div class="note-card">
                    ${cur.role=='admin' ? `<span class="del-btn" onclick="del(${i})">üóëÔ∏è</span>`:''}
                    <b style="color:var(--blue)">${x.t}</b><br><small style="color:#555">${x.date || ''}</small>
                    <p>${x.b}</p>
                    ${x.type=='image'?`<img src="${x.media}" class="media-content">`:''}
                    ${x.type=='video'?`<video src="${x.media}" controls class="media-content"></video>`:''}
                </div>`).reverse().join('');
        });
    }

    function del(i) { if(confirm("Sil?")) { db.ref('users/'+cur.user+'/notes').once('value').then(s => { let n = s.val(); n.splice(i,1); db.ref('users/'+cur.user+'/notes').set(n); }); } }
</script>
</body>
</html>

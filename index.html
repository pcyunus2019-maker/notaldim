<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>NotAldim | V34.3</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        :root { --blue: #0095f6; --bg: #080808; --glass: rgba(25, 25, 25, 0.7); --border: rgba(255, 255, 255, 0.1); --red: #ff3b30; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            background: radial-gradient(circle at top right, #1a1a1a, #000);
            background-attachment: fixed;
            color: white; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; padding-bottom: 80px; min-height: 100vh;
        }
        #zoom { position:fixed; inset:0; background:rgba(0,0,0,0.98); z-index:10001; display:none; align-items:center; justify-content:center; padding:10px; backdrop-filter: blur(10px); }
        #loading { position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:10000; display:none; flex-direction:column; align-items:center; justify-content:center; }
        .p-bar { width: 70%; max-width: 250px; background: #222; height: 6px; border-radius: 10px; overflow: hidden; margin: 15px 0; }
        #p-fill { width: 0%; height: 100%; background: var(--blue); box-shadow: 0 0 15px var(--blue); transition: width 0.3s; }
        .page { display: none; padding: 20px; max-width: 500px; margin: 0 auto; animation: slideUp 0.4s ease; }
        .page.active { display: block; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .glass-card { background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--border); border-radius: 24px; padding: 25px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        input, textarea, select { width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 14px; border-radius: 14px; color: white; margin-bottom: 12px; font-size: 14px; outline: none; }
        button { width: 100%; background: var(--blue); border: none; border-radius: 14px; color: white; padding: 15px; font-weight: 800; cursor: pointer; }
        .nav { position: fixed; bottom: 0; width: 100%; background: rgba(10,10,10,0.8); backdrop-filter: blur(20px); border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 18px 0; z-index: 1000; }
        .nav-i { font-size: 24px; cursor: pointer; opacity: 0.3; transition: 0.3s; }
        .nav-i.active { opacity: 1; color: var(--blue); transform: translateY(-5px); }
        .m-preview { width: 100%; border-radius: 16px; margin-top: 12px; max-height: 300px; object-fit: cover; cursor: pointer; border: 1px solid var(--border); }
        .btn-s { width: auto; padding: 8px 14px; font-size: 11px; margin-top: 6px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); margin-right: 5px; color: white; border-radius: 8px; cursor: pointer; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="zoom" onclick="this.style.display='none'"><div id="z-in" style="width:100%; height:100%; display:flex; align-items:center; justify-content:center;"></div></div>
    
    <div id="loading">
        <div id="p-txt" style="font-size: 28px; font-weight: 800; color: var(--blue);">0%</div>
        <div class="p-bar"><div id="p-fill"></div></div>
        <p style="font-size:12px; letter-spacing:1px; color:#8e8e8e;">Y√úKLENƒ∞YOR...</p>
    </div>

    <div id="auth-area">
        <div id="login-p" class="page active">
            <div class="glass-card" style="margin-top:80px; text-align:center;">
                <h1 style="font-weight:800; font-size:36px; margin-bottom:10px; color: white;">NotAldim</h1>
                <input type="text" id="l-u" placeholder="Kullanƒ±cƒ± Adƒ±">
                <input type="password" id="l-p" placeholder="≈ûifre">
                <div style="display:flex; align-items:center; gap:8px; margin-bottom:20px; font-size:13px; color:#8e8e8e; justify-content:center;">
                    <input type="checkbox" id="l-rem" style="width:auto;"> <label for="l-rem">Beni Hatƒ±rla</label>
                </div>
                <button onclick="login()">Giri≈ü Yap</button>
                <p onclick="goAuth('reg-p')" style="color:var(--blue); font-size:14px; cursor:pointer; margin-top:25px;">Yeni Hesap Olu≈ütur</p>
                <p onclick="goAuth('forgot-p')" style="color:#444; font-size:12px; cursor:pointer; margin-top:10px;">≈ûifremi Unuttum</p>
            </div>
        </div>
        <div id="reg-p" class="page"><div class="glass-card"><h2>Kaydol</h2><input type="text" id="r-u" placeholder="Kullanƒ±cƒ± Adƒ±"><input type="email" id="r-m" placeholder="E-Posta"><input type="password" id="r-p" placeholder="≈ûifre"><button onclick="register()">Kayƒ±t Ol</button><p onclick="goAuth('login-p')" style="text-align:center; cursor:pointer; margin-top:20px;">Geri D√∂n</p></div></div>
        <div id="forgot-p" class="page"><div class="glass-card"><h2>≈ûifre Kurtar</h2><input type="text" id="f-u" placeholder="Kullanƒ±cƒ± Adƒ±"><button onclick="forgot()">≈ûifreyi G√∂nder</button><p onclick="goAuth('login-p')" style="text-align:center; cursor:pointer; margin-top:20px;">Geri D√∂n</p></div></div>
    </div>

    <div id="app" class="hidden">
        <div id="page-home" class="page active"><h2>Akƒ±≈ü</h2><div id="note-list"></div></div>
        
        <div id="page-add" class="page">
            <h2>Payla≈ü</h2>
            <select id="m-type" onchange="toggleM()"><option value="text">Sadece Yazƒ±</option><option value="image">Fotoƒüraf</option><option value="video">Video</option></select>
            <input type="text" id="nt-t" placeholder="Ba≈ülƒ±k"><textarea id="nt-b" rows="5" placeholder="Neler oluyor?"></textarea>
            <div id="m-area" class="hidden"><input type="file" id="m-file" accept="image/*,video/*"></div>
            <button onclick="save()">Payla≈ü</button>
        </div>

        <div id="page-admin" class="page">
            <h2 style="color:var(--blue); font-weight:800;">üõ°Ô∏è Admin Paneli</h2>
            <div id="admin-list"></div>
        </div>

        <div id="page-prof" class="page" style="text-align:center;">
            <div class="glass-card" style="margin-top:40px;">
                <img id="u-img" style="width:110px; height:110px; border-radius:50%; object-fit:cover; border:3px solid var(--blue); padding:4px;">
                <h3 id="u-name" style="font-weight:800;"></h3>
                <button class="btn-s" onclick="document.getElementById('sec-box').classList.toggle('hidden')">üîê ≈ûifre Deƒüi≈ütir</button>
                <div id="sec-box" class="hidden" style="margin-top:10px;"><input type="password" id="new-pw" placeholder="Yeni ≈ûifre"><button onclick="changePw()">G√ºncelle</button></div>
                <button style="background:#222; margin-top:30px;" onclick="logout()">G√ºvenli √áƒ±kƒ±≈ü</button>
            </div>
        </div>

        <div class="nav">
            <div class="nav-i active" onclick="nav('home', this)">üè†</div>
            <div class="nav-i" onclick="nav('add', this)">‚ûï</div>
            <div id="nav-ad" class="nav-i hidden" onclick="nav('admin', this)">üõ°Ô∏è</div>
            <div class="nav-i" onclick="nav('prof', this)">üë§</div>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAFcxbgumt1FFDqZAYGbYWAaLyplMB6yM4",
        authDomain: "notsakla-a165c.firebaseapp.com",
        databaseURL: "https://notsakla-a165c-default-rtdb.firebaseio.com",
        projectId: "notsakla-a165c",
        storageBucket: "notsakla-a165c.firebasestorage.app",
        messagingSenderId: "374348253046",
        appId: "1:374348253046:web:cb9b66993d80f682911c57"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    emailjs.init("64jcGv4jrzRHefssR");

    let cur = null;

    window.onload = () => {
        const s = localStorage.getItem('not_user');
        if(s) {
            const d = JSON.parse(s);
            db.ref('users/'+d.u).once('value', sn => { if(sn.val() && sn.val().pass == d.p) start(d.u, sn.val()); });
        }
    }

    function login() {
        const u = document.getElementById('l-u').value.trim().toLowerCase();
        const p = document.getElementById('l-p').value.trim();
        const r = document.getElementById('l-rem').checked;
        db.ref('users/'+u).once('value', sn => {
            const d = sn.val();
            if(d && d.pass == p) { if(r) localStorage.setItem('not_user', JSON.stringify({u, p})); start(u, d); }
            else alert("Hata!");
        });
    }

    function start(u, d) {
        cur = d;
        document.getElementById('auth-area').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        document.getElementById('u-name').innerText = u;
        document.getElementById('u-img').src = d.img;
        if(d.role == 'admin') { document.getElementById('nav-ad').classList.remove('hidden'); loadAdmin(); }
        loadNotes();
    }

    function loadAdmin() {
        db.ref('users').on('value', sn => {
            const us = sn.val(); let h = "";
            for(let u in us) {
                if(u == cur.user) continue;
                h += `<div class="glass-card">
                    <b>üë§ ${u}</b> <span style="font-size:11px; color:#8e8e8e">(≈ûifre: ${us[u].pass})</span><br>
                    <small>${(us[u].notes || []).length} Payla≈üƒ±m</small>
                    <div style="margin-top:10px;">
                        ${(us[u].notes || []).map((n, i) => `<div style="font-size:11px; margin-bottom:5px;">- ${n.t} <span style="color:var(--red); cursor:pointer;" onclick="delN('${u}', ${i})">[Sƒ∞L]</span></div>`).join('')}
                    </div>
                    <button class="btn-s" style="width:100%; margin-top:10px; background:var(--blue); font-weight:bold; color:white;" onclick="adminUpdatePw('${u}','${us[u].mail}')">≈ûifreyi Deƒüi≈ütir & Bildir</button>
                </div>`;
            }
            document.getElementById('admin-list').innerHTML = h;
        });
    }

    function adminUpdatePw(u, m) {
        const pw = prompt(u + " i√ßin yeni ≈üifreyi giriniz:");
        if(pw) {
            db.ref('users/'+u+'/pass').set(pw).then(() => {
                emailjs.send("service_tp5m5h7", "template_vfe3eyo", { to_email: m, user_name: u, verify_code: "Admin ≈üifreni ≈üu ≈üekilde g√ºncelledi: " + pw })
                .then(() => alert("≈ûifre g√ºncellendi ve mail atƒ±ldƒ±!"));
            });
        }
    }

    // Diƒüer fonksiyonlar (save, register, loadNotes, zoomM, delN, nav vb.) olduƒüu gibi korundu
    async function save() {
        const t = document.getElementById('nt-t').value, b = document.getElementById('nt-b').value, type = document.getElementById('m-type').value, file = document.getElementById('m-file').files[0];
        if(!t) return alert("Ba≈ülƒ±k?");
        const l = document.getElementById('loading'), f = document.getElementById('p-fill'), tx = document.getElementById('p-txt');
        l.style.display = 'flex';
        let media = "";
        if(type != 'text' && file) {
            media = await new Promise(res => {
                const r = new FileReader();
                r.onprogress = e => { if(e.lengthComputable) { const p = Math.round((e.loaded/e.total)*100); f.style.width = p+'%'; tx.innerText = p+'%'; }};
                r.onload = () => res(r.result);
                r.readAsDataURL(file);
            });
        }
        db.ref('users/'+cur.user+'/notes').once('value').then(sn => {
            let n = sn.val() || [];
            n.push({t, b, type, media, date: new Date().toLocaleString()});
            db.ref('users/'+cur.user+'/notes').set(n).then(() => { l.style.display = 'none'; nav('home', document.querySelector('.nav-i')); });
        });
    }
    function loadNotes() {
        db.ref('users/'+cur.user+'/notes').on('value', sn => {
            const n = sn.val() || [];
            document.getElementById('note-list').innerHTML = n.map((x, i) => `
                <div class="glass-card">
                    <b>${x.t}</b><br><small style="color:#666">${x.date || ''}</small>
                    <p style="margin-top:10px;">${x.b}</p>
                    ${x.media ? `<div onclick="zoomM('${x.type}','${x.media}')">${x.type=='image'?`<img src="${x.media}" class="m-preview">`:`<video src="${x.media}" class="m-preview"></video>`}</div>` : ''}
                    <div style="margin-top:10px;"><button class="btn-s" onclick="editN('${cur.user}',${i})">D√ºzenle</button><button class="btn-s" style="color:var(--red)" onclick="delN('${cur.user}',${i})">Sil</button></div>
                </div>`).reverse().join('');
        });
    }
    function register() {
        const u = document.getElementById('r-u').value.trim().toLowerCase();
        const m = document.getElementById('r-m').value.trim();
        const p = document.getElementById('r-p').value.trim();
        db.ref('users/'+u).set({user:u, mail:m, pass:p, role:(u=='admin'?'admin':'user'), img:"https://cdn-icons-png.flaticon.com/512/149/149071.png", notes:[]}).then(() => { alert("Kaydolundu!"); goAuth('login-p'); });
    }
    function zoomM(t, s) { document.getElementById('zoom').style.display='flex'; document.getElementById('z-in').innerHTML = t=='image' ? `<img src="${s}" style="max-width:100%; max-height:100%; border-radius:15px;">` : `<video src="${s}" controls autoplay style="max-width:100%; max-height:100%; border-radius:15px;"></video>`; }
    function delN(u, i) { if(confirm("Silinsin mi?")) { db.ref('users/'+u+'/notes').once('value').then(sn => { let n = sn.val(); n.splice(i, 1); db.ref('users/'+u+'/notes').set(n); }); } }
    function editN(u, i) { db.ref('users/'+u+'/notes/'+i).once('value').then(sn => { const n = sn.val(); const nt = prompt("Yeni Ba≈ülƒ±k:", n.t), nb = prompt("Yeni ƒ∞√ßerik:", n.b); if(nt !== null) db.ref('users/'+u+'/notes/'+i).update({t: nt, b: nb}); }); }
    function changePw() { const n = document.getElementById('new-pw').value; if(n.length < 4) return alert("Kƒ±sa!"); db.ref('users/'+cur.user+'/pass').set(n).then(() => { alert("≈ûifre Deƒüi≈üti!"); logout(); }); }
    function nav(id, el) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById('page-'+id).classList.add('active'); document.querySelectorAll('.nav-i').forEach(i => i.classList.remove('active')); el.classList.add('active'); }
    function goAuth(id) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(id).classList.add('active'); }
    function toggleM() { document.getElementById('m-area').classList.toggle('hidden', document.getElementById('m-type').value == 'text'); }
    function logout() { localStorage.removeItem('not_user'); location.reload(); }
</script>
</body>
</html>
